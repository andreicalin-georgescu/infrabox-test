name: ğŸŒ Terraform Lint, Format and Validate

on:
  pull_request:
    branches: [main]
    paths:
      - '**/*.tf'
      - '**/*.tfvars'
      - '.github/workflows/terraform-validate.yml'

permissions:
  contents: read
  pull-requests: read

jobs:
    terraform-static-analysis:
        name: ğŸ” Terraform Static Analysis
        runs-on: ubuntu-latest

        steps:
          - name: ğŸ›ï¸ Checkout code
            uses: actions/checkout@v4

          - name: ğŸ”§ Set up Terraform
            uses: hashicorp/setup-terraform@v3
            with:
              terraform_version: 1.4.0

          - name: ğŸ¯ Terraform Format Check
            run: terraform fmt -check -recursive

          - name: âœ… Initialize Terraform (no backend)
            run: terraform init -backend=false

          - name: ğŸ” Validate Terraform Configuration
            run: terraform validate

          - name: ğŸ§¹ Install TFLint
            uses: terraform-linters/setup-tflint@v4
            with:
                tflint_version: latest

          - name: ğŸ§ª Run TFLint
            run: tflint --recursive

    terraform-security-scan:
        name: ğŸ” Terraform Security (tfsec)
        runs-on: ubuntu-latest

        steps:
          - name: ğŸ›ï¸ Checkout code
            uses: actions/checkout@v4
          
          - name: ğŸ” Run tfsec
            uses: aquasecurity/tfsec-action@v1.0.0
            
